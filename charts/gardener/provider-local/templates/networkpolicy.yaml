apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-to-kind-network
  namespace: {{ .Release.Namespace }}
  annotations:
    gardener.cloud/description: Allows egress from pods labeled with 'networking.gardener.cloud/to-kind-network=allowed'
      to all containers in the kind docker network. This can be used for example for allowing egress to the garden
      cluster from the second kind cluster.
spec:
  podSelector:
    matchLabels:
      networking.gardener.cloud/to-kind-network: allowed
  egress:
  - to:
    # kind network CIDR
    - ipBlock:
        cidr: 172.18.0.0/24
    - ipBlock:
        cidr: fd00:10::/64
    # range for "load balancer" IPs (manually added to loopback interface on host), including:
    # - local DNS server (bind9): 172.18.255.53 / fd00:ff::53
    # - seed istio ingress-gateway: 172.18.255.1 / fd00:ff::1
    # - seed istio ingress-gateway zones: 172.18.255.1{0,1,2} / fd00:ff::1{0,1,2}
    # - virtual garden istio ingress-gateway: 172.18.255.3 / fd00:ff::3
    - ipBlock:
        cidr: 172.18.255.0/24
    - ipBlock:
        cidr: fd00:ff::/64
  policyTypes:
  - Egress
