cfgs:
  default:
    index: 0
    branches: ['master|release-v.*']
    inherit:
      gardener:
        base_definition:
          repo:
            source_labels:
              - name: cloud.gardener.cnudie/dso/scanning-hints/source_analysis/v1
                value:
                  policy: skip
                  comment: |
                    we use gosec for sast scanning. See attached log.
          traits:
            version:
              preprocess:
                'inject-commit-hash'
              inject_effective_version: true
        jobs:
          head-update:
            steps:
              build-gardenadm:
                image: europe-docker.pkg.dev/gardener-project/releases/ci-infra/golang-test:v20250528-87785b5-1.24
                output_dir: binary
                timeout: 10m
            traits:
              draft_release: ~
              component_descriptor:
                ocm_repository: europe-docker.pkg.dev/gardener-project/snapshots
                ocm_repository_mappings:
                  - repository: europe-docker.pkg.dev/gardener-project/releases
                retention_policy:
                  dry_run: false
                  name: clean-snapshots
                  rules:
                  - keep: 256
                    match: snapshots
                    name: clean-snapshots
                    recursive: false
                    restrict: none
                  - keep: all
                    match: releases
                    name: keep-releases
                    recursive: false
                    restrict: none
              options:
                public_build_logs: true
              version:
                inject_effective_version: true
              publish:
                oci-builder: docker-buildx
                platforms:
                - linux/amd64
                - linux/arm64
                dockerimages:
                  gardener:
                    dockerfile: 'Dockerfile'
                    targets:
                    - name: admission-controller
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/admission-controller
                      target: admission-controller
                    - name: apiserver
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/apiserver
                      target: apiserver
                    - name: controller-manager
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/controller-manager
                      target: controller-manager
                    - name: gardenlet
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/gardenlet
                      target: gardenlet
                    - name: operator
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/operator
                      target: operator
                    - name: resource-manager
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/resource-manager
                      target: resource-manager
                    - name: scheduler
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/scheduler
                      target: scheduler
                    - name: node-agent
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/node-agent
                      target: node-agent
                    - name: gardenadm
                      image: europe-docker.pkg.dev/gardener-project/snapshots/gardener/gardenadm
                      target: gardenadm
                helmcharts:
                - name: controlplane
                  dir: charts/gardener/controlplane
                  registry: europe-docker.pkg.dev/gardener-project/snapshots/charts/gardener
                  mappings:
                  - ref: ocm-resource:admission-controller.repository
                    attribute: global.admission.image.repository
                  - ref: ocm-resource:admission-controller.tag
                    attribute: global.admission.image.tag
                  - ref: ocm-resource:apiserver.repository
                    attribute: global.apiserver.image.repository
                  - ref: ocm-resource:apiserver.tag
                    attribute: global.apiserver.image.tag
                  - ref: ocm-resource:controller-manager.repository
                    attribute: global.controller.image.repository
                  - ref: ocm-resource:controller-manager.tag
                    attribute: global.controller.image.tag
                  - ref: ocm-resource:scheduler.repository
                    attribute: global.scheduler.image.repository
                  - ref: ocm-resource:scheduler.tag
                    attribute: global.scheduler.image.tag
                - name: gardenlet
                  dir: charts/gardener/gardenlet
                  registry: europe-docker.pkg.dev/gardener-project/snapshots/charts/gardener
                  mappings:
                  - ref: ocm-resource:gardenlet.repository
                    attribute: image.repository
                  - ref: ocm-resource:gardenlet.tag
                    attribute: image.tag
                - name: operator
                  dir: charts/gardener/operator
                  registry: europe-docker.pkg.dev/gardener-project/snapshots/charts/gardener
                  mappings:
                  - ref: ocm-resource:operator.repository
                    attribute: image.repository
                  - ref: ocm-resource:operator.tag
                    attribute: image.tag
                - name: resource-manager
                  dir: charts/gardener/resource-manager
                  registry: europe-docker.pkg.dev/gardener-project/snapshots/charts/gardener
                  mappings:
                  - ref: ocm-resource:resource-manager.repository
                    attribute: global.image.repository
                  - ref: ocm-resource:resource-manager.tag
                    attribute: global.image.tag

  release-branches:
    index: 1
    branches: ['release-v.*']
    inherit:
      gardener:
        jobs:
          release:
            steps:
              build-gardenadm:
                image: europe-docker.pkg.dev/gardener-project/releases/ci-infra/golang-test:v20250528-87785b5-1.24
                output_dir: binary
                timeout: 10m
              verify:
                image: europe-docker.pkg.dev/gardener-project/releases/ci-infra/golang-test:v20250528-87785b5-1.24
                vars:
                  TEST_COV: '"yes"'
                  PARALLEL: '"-j16"'
            traits:
              version:
                preprocess: 'finalize'
              release:
                nextversion: 'bump_patch'
                assets:
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-linux-amd64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: linux
                    architecture: amd64
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-linux-arm64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: linux
                    architecture: arm64
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-darwin-amd64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: darwin
                    architecture: amd64
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-darwin-arm64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: darwin
                    architecture: arm64
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-windows-amd64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: windows
                    architecture: amd64
                - type: build-step-file
                  mode: single-file
                  step_name: build-gardenadm
                  step_output_dir: binary
                  path: gardenadm-windows-arm64*
                  name: gardenadm
                  artefact_type: executable
                  artefact_extra_id:
                    os: windows
                    architecture: arm64
                - type: build-step-log
                  step_name: verify
                  purposes:
                  - lint
                  - sast
                  - gosec
                  comment: |
                    we use gosec (linter) for SAST scans
                    see: https://github.com/securego/gosec
                    enabled by https://github.com/gardener/gardener/pull/9959
              slack:
                default_channel: 'internal_scp_workspace'
                channel_cfgs:
                  internal_scp_workspace:
                    channel_name: 'sap-tech-gardener'
                    slack_cfg_name: 'scp_workspace'
              component_descriptor:
                ocm_repository: europe-docker.pkg.dev/gardener-project/releases
                ocm_repository_mappings:
                  - repository: europe-docker.pkg.dev/gardener-project/snapshots
              publish:
                oci-builder: docker-buildx
                platforms:
                - linux/amd64
                - linux/arm64
                dockerimages:
                  gardener:
                    dockerfile: 'Dockerfile'
                    tag_as_latest: true
                    targets:
                    - name: admission-controller
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/admission-controller
                      target: admission-controller
                    - name: apiserver
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/apiserver
                      target: apiserver
                    - name: controller-manager
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/controller-manager
                      target: controller-manager
                    - name: gardenlet
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/gardenlet
                      target: gardenlet
                    - name: operator
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/operator
                      target: operator
                    - name: resource-manager
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/resource-manager
                      target: resource-manager
                    - name: scheduler
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/scheduler
                      target: scheduler
                    - name: node-agent
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/node-agent
                      target: node-agent
                    - name: gardenadm
                      image: europe-docker.pkg.dev/gardener-project/releases/gardener/gardenadm
                      target: gardenadm
                helmcharts:
                - name: controlplane
                  dir: charts/gardener/controlplane
                  registry: europe-docker.pkg.dev/gardener-project/releases/charts/gardener
                  mappings:
                  - ref: ocm-resource:admission-controller.repository
                    attribute: global.admission.image.repository
                  - ref: ocm-resource:admission-controller.tag
                    attribute: global.admission.image.tag
                  - ref: ocm-resource:apiserver.repository
                    attribute: global.apiserver.image.repository
                  - ref: ocm-resource:apiserver.tag
                    attribute: global.apiserver.image.tag
                  - ref: ocm-resource:controller-manager.repository
                    attribute: global.controller.image.repository
                  - ref: ocm-resource:controller-manager.tag
                    attribute: global.controller.image.tag
                  - ref: ocm-resource:scheduler.repository
                    attribute: global.scheduler.image.repository
                  - ref: ocm-resource:scheduler.tag
                    attribute: global.scheduler.image.tag
                - name: gardenlet
                  dir: charts/gardener/gardenlet
                  registry: europe-docker.pkg.dev/gardener-project/releases/charts/gardener
                  mappings:
                  - ref: ocm-resource:gardenlet.repository
                    attribute: image.repository
                  - ref: ocm-resource:gardenlet.tag
                    attribute: image.tag
                - name: operator
                  dir: charts/gardener/operator
                  registry: europe-docker.pkg.dev/gardener-project/releases/charts/gardener
                  mappings:
                  - ref: ocm-resource:operator.repository
                    attribute: image.repository
                  - ref: ocm-resource:operator.tag
                    attribute: image.tag
                - name: resource-manager
                  dir: charts/gardener/resource-manager
                  registry: europe-docker.pkg.dev/gardener-project/releases/charts/gardener
                  mappings:
                  - ref: ocm-resource:resource-manager.repository
                    attribute: global.image.repository
                  - ref: ocm-resource:resource-manager.tag
                    attribute: global.image.tag
