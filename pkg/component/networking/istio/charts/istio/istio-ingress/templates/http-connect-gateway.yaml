{{- if and .Values.httpProxy.enabled .Values.httpProxy.legacyPort.enabled -}}
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: http-connect
  namespace: {{ .Release.Namespace }}
spec:
  selector:
{{ .Values.labels | toYaml | indent 4 }}
  servers:
  - hosts:
    # This service FQDN does not exist, the gateway just needs to be present so that istio opens the port
    - non-existing-blackhole.garden.svc.cluster.local
    port:
      name: tls-tunnel
      number: {{ .Values.httpProxy.legacyPort.port }}
      protocol: HTTP
{{- end }}
