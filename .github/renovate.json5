{
  $schema: 'https://docs.renovatebot.com/renovate-schema.json',
  extends: [
    'config:recommended',
  ],
  labels: [
    'kind/enhancement',
  ],
  postUpdateOptions: [
    'gomodTidy',
  ],
  prFooter: '**Release note**:\n```other dependency\nNONE\n```',
  customManagers: [
    {
      customType: 'regex',
      fileMatch: [
        'Makefile$',
        '\\.mk$',
        '\\.sh$',
      ],
      matchStrings: [
        '# renovate: datasource=(?<datasource>[a-z-.]+?) depName=(?<depName>[^\\s]+?)(?: (lookupName|packageName)=(?<packageName>[^\\s]+?))?(?: versioning=(?<versioning>[^\\s]+?))?(?: extractVersion=(?<extractVersion>[^\\s]+?))?(?: registryUrl=(?<registryUrl>[^\\s]+?))?\\s.+?_(VERSION|version) *[?:]?= *"?(?<currentValue>.+?)"?\\s',
      ],
    },
    {
      customType: 'regex',
      fileMatch: [
        '^example/.+\\.yaml$',
        '^hack/.+\\.yaml$',
        '^\\.test-defs/.+\\.yaml$',
      ],
      matchStrings: [
        'image: ["|\']?(?<depName>.*?):(?<currentValue>.*?)["|\']?\\s',
      ],
      datasourceTemplate: 'docker',
    },
    {
      customType: 'regex',
      fileMatch: [
        '/kustomization\\.yaml$',
      ],
      matchStrings: [
        'https://github\\.com/(?<depName>[^/]*/[^/]*?)/releases/download/(?<currentValue>.*?)/',
        'https://raw\\.githubusercontent\\.com/(?<depName>[^/]*/[^/]*?)/(?<currentValue>.*?)/',
      ],
      datasourceTemplate: 'github-releases',
    },
    {
      customType: 'regex',
      fileMatch: [
        '^hack/.+\\.sh$',
      ],
      matchStrings: [
        '--image[=| ]["|\']?(?<depName>.*?):(?<currentValue>.*?)["|\']?\\s',
      ],
      datasourceTemplate: 'docker',
    },
    {
      customType: 'regex',
      fileMatch: [
        '^imagevector/containers.yaml$',
      ],
      matchStrings: [
        '\\s+repository:\\s+(?<depName>.*?)\\n\\s+tag:\\s+["]?(?<currentValue>.*?)["]?\\n',
      ],
      datasourceTemplate: 'docker',
    },
    {
      customType: 'regex',
      fileMatch: [
        '^imagevector/containers.yaml$',
      ],
      matchStrings: [
        '\\s+sourceRepository:\\s+github.com/(?<depName>.*?)\\n\\s+repository:\\s+.*\\n\\s+tag:\\s+["]?(?<currentValue>.*?)["]?\\n',
      ],
      datasourceTemplate: 'github-releases',
    },
    {
      customType: 'regex',
      fileMatch: [
        '^pkg/provider-local/imagevector/images.yaml$',
      ],
      matchStrings: [
        '(?<depName>gcr\\.io/k8s-staging-kind/.*?):(?<currentValue>.*?)\\s',
      ],
      datasourceTemplate: 'docker',
    },
  ],
  separateMinorPatch: true,
  packageRules: [
    {
      matchDatasources: [
        'go',
      ],
      postUpgradeTasks: {
        commands: [
          'make generate MODE=sequential',
        ],
        executionMode: 'branch',
      },
      matchPackageNames: [
        '/.+/api/.+/',
        '/.+/apis/.+/',
      ],
    },
    {
      groupName: 'golang',
      matchDatasources: [
        'docker',
      ],
      matchPackageNames: [
        '/golang/',
      ],
    },
    {
      groupName: 'istio images',
      matchDatasources: [
        'docker',
      ],
      matchPackageNames: [
        '/gcr\\.io/istio-release/.+/',
      ],
    },
    {
      groupName: 'istio modules',
      matchDatasources: [
        'go',
      ],
      matchPackageNames: [
        '/istio\\.io/api/',
        '/istio\\.io/client-go/',
      ],
    },
    {
      groupName: 'etcd-druid',
      matchDatasources: [
        'github-releases',
        'go',
      ],
      matchPackageNames: [
        '/github\\.com/gardener/etcd-druid/',
        '/gardener/etcd-druid/',
      ],
    },
    {
      groupName: 'prometheus-operator images',
      matchDatasources: [
        'docker',
        'go',
      ],
      matchPackageNames: [
        '/quay\\.io/prometheus-operator/.+/',
        '/github\\.com/prometheus-operator/prometheus-operator/pkg/apis/.+/',
      ],
    },
    {
      matchDatasources: [
        'go',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      dependencyDashboardApproval: true,
      matchPackageNames: [
        '/k8s\\.io/.+/',
        '/sigs\\.k8s\\.io/controller-runtime/',
        '/istio\\.io/.+/',
        '/github\\.com/fluent/.+/',
      ],
    },
    {
      matchDatasources: [
        'docker',
        'github-releases',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      dependencyDashboardApproval: true,
      matchPackageNames: [
        '/fluent/.+/',
        '/gcr\\.io/istio-release/.+/',
        '/europe-docker\\.pkg\\.dev/gardener-project/releases/3rd/credativ/valitail/',
      ],
    },
    {
      matchDatasources: [
        'docker',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      dependencyDashboardApproval: true,
      matchPackageNames: [
        '/kindest/node/',
      ],
    },
    {
      matchDatasources: [
        'docker',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      matchFileNames: [
        'hack/tools/image/variants\\.yaml',
      ],
      enabled: false,
    },
    {
      matchManagers: [
        'gomod',
      ],
      matchUpdateTypes: [
        'patch',
      ],
      enabled: false,
      matchPackageNames: [
        '/go/',
      ],
    },
    {
      matchDatasources: [
        'go',
      ],
      matchFileNames: [
        'hack/tools/logcheck/go\\.mod',
      ],
      enabled: false,
    },
    {
      matchDatasources: [
        'docker',
        'github-releases',
      ],
      matchUpdateTypes: [
        'major',
        'minor',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      enabled: false,
      matchPackageNames: [
        '/gardener/autoscaler/',
      ],
    },
    {
      matchDatasources: [
        'docker',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      enabled: false,
      matchPackageNames: [
        '/europe-docker\\.pkg\\.dev/gardener-project/releases/.+/',
        '!/europe-docker\\.pkg\\.dev/gardener-project/releases/3rd/alpine/',
        '!/europe-docker\\.pkg\\.dev/gardener-project/releases/3rd/kubernetesui/.+/',
      ],
    },
    {
      matchDatasources: [
        'github-releases',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      enabled: false,
      matchPackageNames: [
        '!/gardener/.+/',
        '!/credativ/.+/',
        '!/envoyproxy/.+/',
        '!/fluent/.+/',
      ],
    },
    {
      enabled: false,
      matchPackageNames: [
        '/local-skaffold/.+/',
      ],
    },
    {
      matchDatasources: [
        'go',
      ],
      enabled: false,
      matchPackageNames: [
        '/k8s\\.io/kube-openapi/',
      ],
    },
    {
      matchDatasources: [
        'go',
      ],
      enabled: false,
      matchPackageNames: [
        '/sigs\\.k8s\\.io/controller-runtime/tools/setup-envtest/',
      ],
    },
    {
      matchFileNames: [
        'chart/**',
        'cmd/**',
        'extensions/**',
        'pkg/**',
        'plugin/**',
        'test/**',
        'third_party/**',
      ],
      enabled: false,
    },
    {
      matchFileNames: [
        'pkg/provider-local/node/*',
      ],
      enabled: true,
    },
    {
      matchDatasources: [
        'docker',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      prFooter: '**Release note**:\n```other dependency\nThe `{{depName}}` image has been updated to `{{newVersion}}`.\n```',
    },
    {
      matchDatasources: [
        'github-releases',
      ],
      matchFileNames: [
        'imagevector/**',
      ],
      prFooter: '**Release note**:\n```other dependency\nThe `{{depName}}` image has been updated to `{{newVersion}}`. [Release Notes](https://github.com/{{depName}}/releases/tag/{{newVersion}})\n```',
    },
  ],
}
